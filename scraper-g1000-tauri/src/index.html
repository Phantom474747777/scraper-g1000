<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraper G1000</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Main App Container -->
    <div id="app" class="app-container">
        <!-- Profile Selection Screen (Initial) -->
        <div id="profile-selector" class="screen active">
            <div class="centered-content">
                <div class="app-logo">
                    <h1 class="app-title">Scraper G1000</h1>
                    <p class="app-subtitle">Business Lead Generation</p>
                </div>

                <div class="profile-list" id="profileList">
                    <!-- Profiles will be loaded here -->
                    <div class="profile-loading">Loading profiles...</div>
                </div>

                <button class="btn-create-profile" id="btnCreateProfile">
                    <span>+ Create New Profile</span>
                </button>
            </div>
        </div>

        <!-- Mode Selection Screen -->
        <div id="mode-selector" class="screen">
            <div class="centered-content">
                <div class="app-logo">
                    <h1 class="app-title">Scraper G1000</h1>
                    <p class="app-subtitle">Lead Generation System</p>
                    <p class="profile-name" id="modeProfileName">CritterCaptures</p>
                </div>

                <div class="mode-selection-grid">
                    <div class="mode-card" id="cardSelectManual">
                        <h2 class="mode-title">Manual Mode</h2>
                        <p class="mode-description">Hand-pick locations, categories, and settings for precise control</p>
                        <div class="mode-features">
                            <div class="feature-item">• Custom ZIP selection</div>
                            <div class="feature-item">• Live scraping console</div>
                            <div class="feature-item">• Real-time progress</div>
                        </div>
                    </div>

                    <div class="mode-card" id="cardSelectAutomation">
                        <h2 class="mode-title">Automation Mode</h2>
                        <p class="mode-description">Set it and forget it with smart automation across multiple targets</p>
                        <div class="mode-features">
                            <div class="feature-item">• Batch scraping</div>
                            <div class="feature-item">• Pause/Resume support</div>
                            <div class="feature-item">• Progress persistence</div>
                        </div>
                    </div>
                </div>

                <div class="mode-footer">
                    <button class="btn-secondary" id="btnViewLeadsFromMode">View All Leads</button>
                    <button class="btn-back" id="btnBackFromMode">← Change Profile</button>
                </div>
            </div>
        </div>

        <!-- Manual Scrape Screen (v2.0 Redesign) -->
        <div id="manual-scrape" class="screen">
            <div class="screen-header">
                <button class="btn-back" id="btnBackFromManual">← Back</button>
                <h1>Manual Mode</h1>
                <div class="hotkey-hints">
                    <button class="btn-reset" id="btnResetManualMode">
                        ↻ Reset
                    </button>
                </div>
            </div>

            <div class="manual-content">
                <!-- Left Panel: Configuration -->
                <div class="manual-config-panel">
                    <div class="glass-panel">
                        <h3 class="panel-title">Configuration</h3>

                        <!-- Location Selection -->
                        <div class="config-section">
                            <label class="config-label">City</label>
                            <input type="text" id="inputManualCity" placeholder="Dover" class="glass-input">
                        </div>

                        <div class="config-section">
                            <label class="config-label">State (2-letter)</label>
                            <input type="text" id="inputManualState" placeholder="FL" class="glass-input" maxlength="2">
                        </div>

                        <!-- Radius Slider -->
                        <div class="config-section">
                            <label class="config-label">Search Radius</label>
                            <div class="radius-slider-container">
                                <input type="range" id="inputManualRadius" min="10" max="100" value="50" step="5" class="radius-slider">
                                <div class="radius-value"><span id="radiusValue">50</span> miles</div>
                            </div>
                        </div>

                        <!-- Find ZIPs Button -->
                        <div class="config-section">
                            <button class="btn-find-zips" id="btnFindManualZips">
                                <span>Find ZIP Codes</span>
                            </button>
                        </div>

                        <!-- ZIP Dropdown (appears after finding ZIPs) -->
                        <div class="config-section" id="zipSelectionSection" style="display: none;">
                            <label class="config-label">Select ZIP Code</label>
                            <select id="selectManualZip" class="glass-select">
                                <option value="">Choose a ZIP...</option>
                            </select>
                        </div>

                        <div class="config-section">
                            <label class="config-label">Category</label>
                            <select id="selectManualCategory" class="glass-select">
                                <option value="">Choose a category...</option>
                                <!-- Categories will be loaded from profile data -->
                            </select>
                        </div>

                        <!-- Custom Category Input -->
                        <div class="config-section">
                            <label class="config-label">Or Enter Custom Category</label>
                            <input type="text" id="inputCustomCategory" placeholder="e.g., Tree Services, Electricians..." class="glass-input">
                            <span class="config-hint">Leave blank if using dropdown above</span>
                        </div>

                        <!-- Start Button -->
                        <button class="btn-start-scraping" id="btnStartManualScrape" disabled>
                            <span class="btn-icon">▶</span>
                            <span>Start Scraping</span>
                        </button>
                    </div>
                </div>

                <!-- Right Panel: Live Console -->
                <div class="manual-console-panel">
                    <div class="glass-panel console-panel">
                        <div class="console-header">
                            <h3 class="panel-title">Live Console</h3>
                            <div class="console-status" id="consoleStatus">
                                <span class="status-dot status-idle"></span>
                                <span class="status-text">Idle</span>
                            </div>
                        </div>

                        <div class="console-output" id="consoleOutput">
                            <div class="console-line console-system">System Ready</div>
                            <div class="console-line console-system">Configure settings and click Start to begin</div>
                        </div>

                        <!-- Progress Bar (Hidden until scraping) -->
                        <div class="console-progress" id="consoleProgress" style="display: none;">
                            <div class="progress-bar-wrapper">
                                <div class="progress-bar-fill" id="consoleProgressBar" style="width: 0%"></div>
                            </div>
                            <div class="progress-stats">
                                <span id="consoleProgressText">Page 0 of 0</span>
                                <span id="consoleProgressLeads">0 leads</span>
                            </div>
                        </div>

                        <!-- View Leads Button (appears after scraping completes) -->
                        <button class="btn-view-leads" id="btnViewScrapedLeads" style="display: none;">
                            <span class="btn-icon">→</span>
                            <span>View Leads</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Automation Mode Screen (COMPLETE REDESIGN - SIDE-BY-SIDE LAYOUT) -->
        <div id="automation-mode" class="screen">
            <div class="screen-header">
                <button class="btn-back" id="btnBackFromAutomation">← Back</button>
                <h1>Automation Mode</h1>
                <div class="hotkey-hints">
                    <button class="btn-reset" id="btnResetAutomationMode">
                        ↻ Reset
                    </button>
                </div>
            </div>

            <div class="manual-content" style="max-width: 100%; padding: 2rem;">
                <!-- Left Panel: Batch Configuration (WIDER, SIDE-BY-SIDE) -->
                <div class="manual-config-panel" style="flex: 0 0 750px; min-width: 750px; max-width: 750px;">
                    <div class="glass-panel">
                        <h3 class="panel-title" style="font-size: 1.2rem; margin-bottom: 0.7rem;">Configuration</h3>

                        <!-- Location + Radius in ONE COMPACT ROW -->
                        <div style="display: flex; gap: 0.75rem; margin-bottom: 0.7rem;">
                            <div style="flex: 1;">
                                <label class="config-label" style="font-size: 0.7rem; margin-bottom: 0.25rem; display: block;">City</label>
                                <input type="text" id="inputAutoCity" placeholder="Dover" class="glass-input" style="padding: 0.5rem 0.7rem; font-size: 0.9rem;">
                            </div>
                            <div style="flex: 0 0 70px;">
                                <label class="config-label" style="font-size: 0.7rem; margin-bottom: 0.25rem; display: block;">State</label>
                                <input type="text" id="inputAutoState" placeholder="FL" class="glass-input" maxlength="2" style="padding: 0.5rem 0.7rem; text-align: center; font-size: 0.9rem;">
                            </div>
                            <div style="flex: 0 0 140px;">
                                <label class="config-label" style="font-size: 0.7rem; margin-bottom: 0.25rem; display: block;">Radius</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="range" id="inputAutoRadius" min="10" max="100" value="50" step="5" class="radius-slider" style="flex: 1;">
                                    <span style="color: rgba(139, 92, 246, 1); font-weight: 600; font-size: 0.8rem; width: 40px;"><span id="autoRadiusValue">50</span>mi</span>
                                </div>
                            </div>
                        </div>

                        <button class="btn-find-zips" id="btnFindAutoZips" style="width: 100%; margin-bottom: 0.7rem; padding: 0.6rem;">
                            Find ZIP Codes
                        </button>

                        <!-- ZIPS + CATEGORIES SIDE BY SIDE (THE FIX!) -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.7rem;">
                            <!-- ZIP Selection -->
                            <div id="autoZipSelectionSection" style="display: none;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                    <label class="config-label" style="margin: 0; font-size: 0.75rem;">ZIPs <span id="autoZipCount" style="color: rgba(139, 92, 246, 1);">(0)</span></label>
                                    <button class="btn-select-all" id="btnSelectAllZips" style="padding: 0.25rem 0.6rem; font-size: 0.7rem;">All</button>
                                </div>
                                <div class="multiselect-box-compact" id="autoZipMultiselect" style="max-height: 110px; overflow-y: auto;"></div>
                            </div>

                            <!-- Category Selection -->
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem;">
                                    <label class="config-label" style="margin: 0; font-size: 0.75rem;">Categories <span id="autoCategoryCount" style="color: rgba(139, 92, 246, 1);">(0)</span></label>
                                    <button class="btn-select-all" id="btnSelectAllCategories" style="padding: 0.25rem 0.6rem; font-size: 0.7rem;">All</button>
                                </div>
                                <div class="multiselect-box-compact" id="autoCategoryMultiselect" style="max-height: 110px; overflow-y: auto;">
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Real Estate Agents">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Real Estate</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Property Managers">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Property Mgmt</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Home Inspectors">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Home Inspectors</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Construction Companies">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Construction</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Roofing Contractors">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Roofing</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="HVAC Services">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">HVAC</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Plumbing Companies">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Plumbing</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Landscaping Companies">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Landscaping</span>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" value="Cleaning Services">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">Cleaning</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Pages + Skip Checkbox in ONE ROW -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.7rem;">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="autoSkipScraped" checked>
                                <span class="checkmark"></span>
                                <span class="checkbox-label" style="font-size: 0.8rem;">Skip already scraped</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label class="config-label" style="margin: 0; font-size: 0.75rem;">Pages</label>
                                <div class="number-stepper-with-max">
                                    <button class="stepper-btn" id="autoDecrementPages">−</button>
                                    <input type="text" id="autoMaxPages" value="2" readonly class="stepper-value">
                                    <button class="stepper-btn" id="autoIncrementPages">+</button>
                                    <button class="stepper-btn-max" id="autoMaxPagesBtn">MAX</button>
                                </div>
                            </div>
                        </div>

                        <!-- Job Summary (Compact) -->
                        <div style="margin-bottom: 0.7rem; padding: 0.6rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 6px; text-align: center;" id="autoJobSummary" style="display: none;">
                            <div style="font-size: 1.3rem; font-weight: 700; color: rgba(139, 92, 246, 1);">
                                <span id="autoTotalJobs">0</span> jobs queued
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.2rem;">
                                <span id="autoJobBreakdown">0 ZIPs × 0 Categories</span>
                            </div>
                        </div>

                        <!-- Sound Toggle + Start Button -->
                        <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0;">
                            <div style="position: relative; flex: 0 0 auto;">
                                <button class="btn-sound-toggle" id="btnSoundToggle" onclick="toggleCompletionSound()" style="padding: 0.7rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: var(--text-primary); cursor: pointer; font-size: 1.2rem;">
                                    🔔
                                </button>
                                <div style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); white-space: nowrap; font-size: 0.65rem; color: rgba(172, 172, 172, 0.8); pointer-events: none;">
                                    Completion sound
                                </div>
                            </div>
                            <button class="btn-start-scraping" id="btnStartAutomation" disabled style="flex: 1; padding: 0.7rem;">
                                <span class="btn-icon">▶</span>
                                <span>Start Automation</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Live Console (Takes remaining space) -->
                <div class="manual-console-panel" style="flex: 1;">
                    <div class="glass-panel console-panel">
                        <div class="console-header">
                            <h3 class="panel-title">Live Console</h3>
                            <div class="console-status" id="autoConsoleStatus">
                                <span class="status-dot status-idle"></span>
                                <span class="status-text">Idle</span>
                            </div>
                        </div>

                        <!-- Circular Timer (shown during automation) -->
                        <div class="automation-timer" id="autoTimer" style="display: none;">
                            <div class="timer-circle-container">
                                <svg class="timer-circle" viewBox="0 0 120 120">
                                    <circle class="timer-circle-bg" cx="60" cy="60" r="54"></circle>
                                    <circle class="timer-circle-progress" cx="60" cy="60" r="54" id="autoTimerCircle"></circle>
                                </svg>
                                <div class="timer-content">
                                    <div class="timer-elapsed" id="autoTimerElapsed">00:00</div>
                                    <div class="timer-label">Elapsed</div>
                                </div>
                            </div>
                            <div class="timer-stats">
                                <div class="timer-stat">
                                    <span class="timer-stat-label">ETA:</span>
                                    <span class="timer-stat-value" id="autoTimerETA">--:--</span>
                                </div>
                                <div class="timer-stat">
                                    <span class="timer-stat-label">Speed:</span>
                                    <span class="timer-stat-value" id="autoTimerSpeed">-- leads/min</span>
                                </div>
                            </div>
                        </div>

                        <!-- Queue Preview (before starting) -->
                        <div class="queue-preview" id="autoQueuePreview">
                            <div class="console-line console-system">Configure settings to preview automation queue</div>
                        </div>

                        <!-- Live Console (during automation) -->
                        <div class="console-output" id="autoConsoleOutput" style="display: none;">
                            <!-- Live logs appear here during scraping -->
                        </div>

                        <!-- Progress Bar -->
                        <div class="console-progress" id="autoConsoleProgress" style="display: none;">
                            <div class="progress-bar-wrapper">
                                <div class="progress-bar-fill" id="autoProgressBar" style="width: 0%"></div>
                            </div>
                            <div class="progress-stats">
                                <span id="autoProgressText">Job 0 of 0</span>
                                <span id="autoProgressLeads">0 leads</span>
                            </div>
                        </div>

                        <!-- Control Buttons (during automation) -->
                        <div class="automation-controls" id="autoControls" style="display: none;">
                            <button class="btn-pause" id="btnPauseAutomation">
                                <span>⏸ Pause</span>
                            </button>
                            <button class="btn-resume" id="btnResumeAutomation" style="display: none;">
                                <span>▶ Resume</span>
                            </button>
                            <button class="btn-stop" id="btnStopAutomation">
                                <span>⏹ Stop</span>
                            </button>
                        </div>

                        <!-- View Leads Button (after completion) -->
                        <button class="btn-view-leads" id="btnViewAutoLeads" style="display: none;">
                            <span class="btn-icon">→</span>
                            <span>View All Leads</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leads Dashboard Screen -->
        <div id="leads-dashboard" class="screen">
            <!-- Top Navigation Bar -->
            <div class="leads-header">
                <button class="btn-back" id="btnBackFromLeadsDashboard">← Back</button>
                <h1>Leads</h1>
            </div>

            <!-- Sticky KPI Bar -->
            <div class="kpi-bar">
                <div class="kpi-card clickable" id="cardAllLeads">
                    <div class="kpi-value" id="cardAllLeadsCount">0</div>
                    <div class="kpi-label">All Leads</div>
                </div>

                <div class="kpi-card clickable" id="cardUncontacted">
                    <div class="kpi-value" id="cardUncontactedCount">0</div>
                    <div class="kpi-label">Uncontacted</div>
                </div>

                <div class="kpi-card clickable" id="cardContacted">
                    <div class="kpi-value" id="cardContactedCount">0</div>
                    <div class="kpi-label">Contacted</div>
                </div>

                <div class="kpi-card clickable" id="cardArchived">
                    <div class="kpi-value" id="cardArchivedCount">0</div>
                    <div class="kpi-label">Archived</div>
                </div>
            </div>

            <!-- Scrollable Content Area -->
            <div class="leads-content">
                <!-- Toggle Section -->
                <div class="view-toggle">
                    <button class="toggle-btn active" id="btnViewZips">By ZIP Code</button>
                    <button class="toggle-btn" id="btnViewCategories">By Category</button>
                    <button class="toggle-btn" id="btnViewCombined">ZIP + Category</button>
                </div>

                <!-- Combined Filter Section (Smart Multi-Filter!) -->
                <div id="combinedSection" class="content-section" style="display: none;">
                    <div class="combined-filter-panel">
                        <div class="filter-row-multi">
                            <div class="filter-col">
                                <label>City</label>
                                <input list="cityList" id="filterCombinedCity" placeholder="Type or select..." class="glass-input">
                                <datalist id="cityList"></datalist>
                            </div>
                            <div class="filter-col">
                                <label>ZIP Code</label>
                                <input list="zipList" id="filterCombinedZip" placeholder="Type or select..." class="glass-input">
                                <datalist id="zipList"></datalist>
                            </div>
                            <div class="filter-col">
                                <label>Category</label>
                                <input list="categoryList" id="filterCombinedCategory" placeholder="Type or select..." class="glass-input">
                                <datalist id="categoryList"></datalist>
                            </div>
                            <div class="filter-col filter-button-col">
                                <button class="btn-primary" id="btnApplyCombinedFilter">Search</button>
                            </div>
                        </div>
                        <div id="combinedResults" class="combined-results"></div>
                    </div>
                </div>

                <!-- By ZIP Code Section -->
                <div id="zipSection" class="content-section">
                    <div class="zip-cards-grid" id="zipCards">
                        <!-- ZIP cards will be loaded here -->
                        <div class="loading-placeholder">Loading ZIP codes...</div>
                    </div>
                </div>

                <!-- By Category Section (Hidden by default) -->
                <div id="categorySection" class="content-section" style="display: none;">
                    <div class="category-cards-grid" id="categoryCards">
                        <!-- Category cards will be loaded here -->
                        <div class="loading-placeholder">Loading categories...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leads List View -->
        <div id="leads-list" class="screen">
            <div class="screen-header">
                <button class="btn-back" id="btnBackFromList">← Back</button>
                <div class="breadcrumb" id="breadcrumb">All Leads</div>
                <div class="header-actions">
                    <input type="search" id="searchLeads" placeholder="Search leads..." class="search-field">
                    <button class="btn-primary" id="btnExportLeads">Export ↓</button>
                </div>
            </div>

            <!-- Bulk Actions Toolbar -->
            <div class="bulk-actions-toolbar" id="bulkActionsToolbar" style="display: none;">
                <div class="bulk-actions-left">
                    <span id="bulkSelectedCount">0</span> selected
                </div>
                <div class="bulk-actions-right">
                    <button class="btn-bulk" id="btnBulkContact">Mark Contacted</button>
                    <button class="btn-bulk" id="btnBulkArchive">Archive</button>
                </div>
            </div>

            <div class="leads-table-container">
                <table class="leads-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll"></th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Category</th>
                            <th>City</th>
                            <th>ZIP</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTableBody">
                        <tr>
                            <td colspan="7" class="loading">Loading leads...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-footer">
                <div>Showing <span id="leadsCount">0</span> leads</div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Leads</h2>
                <button class="modal-close" id="btnCloseExportModal">×</button>
            </div>
            <div class="modal-body">
                <div class="export-option-group">
                    <label>Export Scope</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="exportScope" value="current" checked>
                            <span>Current View (<span id="exportCurrentCount">0</span> leads)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="exportScope" value="selected">
                            <span>Selected Only (<span id="exportSelectedCount">0</span> leads)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="exportScope" value="all">
                            <span>All Leads (<span id="exportAllCount">0</span> leads)</span>
                        </label>
                    </div>
                </div>

                <div class="export-option-group">
                    <label>File Format</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="exportFormat" value="csv" checked>
                            <span>CSV (.csv)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="exportFormat" value="xlsx">
                            <span>Excel (.xlsx)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelExport">Cancel</button>
                <button class="btn-primary" id="btnConfirmExport">Export & Save</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="js/app.js"></script>
</body>
</html>
